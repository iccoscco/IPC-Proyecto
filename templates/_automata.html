<input type="hidden" id="usuario_id" value="{{ usuario_id }}">

<div class="automata-inner">
  <div style="margin-top: 20px;">
    <h3>Avatar actual:</h3>
    <div id="avatar-container">
      {% if avatar_svg %}
        {{ avatar_svg | safe }}
      {% else %}
        <p>No hay avatar disponible.</p>
      {% endif %}
    </div>
  </div>

  <!-- BotÃ³n para iniciar el autÃ³mata -->
  <div id="ui" style="margin-bottom:10px;">
      <button type="button" id="btn-iniciar">ğŸ—£ Iniciar registro por voz</button>
  </div>

  <div class="conversacion-contenedor">
    <!-- Chat principal -->
    <div class="chat-box">
      <h3>ğŸ—£ï¸ ConversaciÃ³n</h3>
      <div id="chat" style="height: 300px; overflow-y: auto;"></div>
    </div>

    <!-- Chat tÃ©cnico -->
    <div class="chat-box debug">
      <h3>ğŸ§ª DepuraciÃ³n</h3>
      <div id="debug" style="height: 300px; overflow-y: auto; font-size: 0.9em; color: #333;"></div>
    </div>
  </div>
</div>

<script type="module">
  import { iniciarAutomata } from "{{ url_for('static', filename='js/automata/main.js') }}";

  const ruta = window.location.pathname;
  const params = new URLSearchParams(window.location.search);
  const boton = document.getElementById('btn-iniciar');

  // FunciÃ³n para saber si hay parÃ¡metros clave
  const tieneIDs = () => {
    return params.has('id_usuario') || params.has('id_pedido');
  };

  // Mostrar/ocultar el botÃ³n segÃºn la lÃ³gica
  if (boton) {
    if (tieneIDs()) {
      boton.style.display = 'none';
      iniciarAutomata();  // Se ejecuta automÃ¡ticamente si hay ID
    } else {
      boton.style.display = 'inline-block';
      boton.addEventListener('click', () => {
        iniciarAutomata();
      });
    }
  }

  // TambiÃ©n podrÃ­as enviar los IDs al autÃ³mata si es necesario
  window.contextoAutomata = {
    ruta,
    id_usuario: params.get('id_usuario') || null,
    id_pedido: params.get('id_pedido') || null,
  };
</script>

